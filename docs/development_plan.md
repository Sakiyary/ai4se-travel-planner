# 开发计划与准备清单

本文档在正式搭建项目结构前，明确实施步骤、时间安排与质量保障措施，确保开发过程可控并便于团队协作。

## 1. 项目目标

- 基于 Next.js + Supabase + 高德地图 + 科大讯飞 ASR + 通义千问 DashScope 搭建 AI 旅行规划师 Web 端。
- 核心功能：语音/文本输入、AI 行程生成、预算计算、费用记录与云端同步。
- 提供 Docker 镜像以便助教在本地快速运行并评分。

## 2. 里程碑与时间表（示例，可根据课程节奏调整）

| 阶段 | 目标 | 预计时间 | 产出 |
| --- | --- | --- | --- |
| M1 需求梳理 | 熟读原始需求，确认功能优先级与 MVP 范围 | 第 1 周 | updated requirements checklist |
| M2 技术验证 | 完成 Supabase、高德、讯飞、DashScope 接口可用性验证 | 第 1-2 周 | PoC demo + 接口调用笔记 |
| M3 框架搭建 | 初始化 Next.js 项目、全局样式、路由与状态管理 | 第 2-3 周 | 初始代码库、基本页面骨架 |
| M4 功能实现 | 逐一完成行程生成、费用记录、语音输入等核心模块 | 第 3-5 周 | 核心功能可运行的分支 |
| M5 测试与打磨 | 由用户手动测试、UI 优化、性能与安全检查 | 第 5-6 周 | 修复记录 |
| M6 交付 | 打包 Docker 镜像，更新 README | 第 6 周 | 发布版本、镜像链接 |

## 3. 功能拆解与任务清单

| 模块 | 子任务 | 说明 | 优先级 |
| --- | --- | --- | --- |
| 认证与账户 | 集成 Supabase Auth、实现登录/登出 | 基于邮箱或第三方登录 | 高 |
| 用户偏好管理 | 旅伴信息、预算偏好表单 | 保存在 Supabase `profiles` | 中 |
| 语音输入 | 浏览器录音、上传科大讯飞 ASR、文本回显 | 首批支持普通话 | 高 |
| 文本输入 | 表单输入旅行目的与偏好 | 与语音输入统一模型参数 | 高 |
| 行程生成 | DashScope prompt 设计、结果解析、UI 展示 | 输出按日行程与要点 | 高 |
| 预算计算 | 前端解析 LLM 结果并补充自定义规则 | 表格 + 图表展示预算结构 | 中 |
| 费用记录 | 手动录入、语音识别生成、列表与统计 | 同步至 Supabase `expenses` | 中 |
| 地图展示 | 高德地图渲染、POI 标记、行程线路 | 与行程数据联动 | 中 |
| 计划管理 | 列表、详情、保存/更新/删除 | Supabase 数据持久化 | 高 |

## 4. 技术与配置准备

- 平台密钥：参考 `docs/platform_setup.md`，确保科大讯飞、DashScope、高德、Supabase 等账号及 API Key 可用。
- 环境文件：准备 `.env.example`，列出前端运行所需变量；实际值放在 `.env.local`（开发）与 `docker/.env`（运行）。
- 代码规范：采用 ESLint + Prettier + TypeScript 严格模式，Tailwind + Chakra 统一 UI 风格。
- 依赖管理：使用 `pnpm` 统一版本；在 README 中记录常用命令。

## 5. 质量保障计划

不需要质量保障

## 6. 风险与缓解措施

| 风险 | 影响 | 缓解策略 |
| --- | --- | --- |
| 外部 API 限流或变更 | 无法生成行程/转写语音 | 提前申请足够额度；实现错误提示与重试机制 |
| 语音识别准确率不佳 | 用户体验下降 | 提供文本编辑入口，支持多次修改后再提交 |
| LLM 输出结构不稳定 | 数据解析失败 | 使用严格 JSON Schema + Fall-back 模板；在前端容错处理 |
| 地图与 LLM 数据不一致 | POI 展示错误 | 引入高德 POI 二次验证，提示用户手动调整 |
| Docker 镜像体积过大 | 评分下载不便 | 采用多阶段构建，剔除开发依赖，压缩静态资源 |
| 安全性风险（密钥泄露） | 账号被封或额外费用 | 通过环境变量注入、设置 Referer 白名单，必要时构建轻量 API 代理 |

## 7. 后续文档与交付物

- **README**：待项目初始化后补充运行步骤、Docker 使用说明、功能截图。
- **`.env.example`**：列出必需环境变量，避免密钥泄露。
- **用户手册（可选）**：准备简易操作指南，便于助教快速体验。

请在开始编码前，根据此文档核对所有前置条件，确保团队对时间线、任务优先级与质量标准达成一致。
